



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Traffic Ops - Migrating from 2.0 to 2.2 &mdash; Traffic Control 2.2-dev documentation </title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Traffic Control 2.2-dev documentation" href="../../index.html"/>
        <link rel="up" title="Administrator’s Guide" href="../index.html"/>
        <link rel="next" title="Traffic Ops - Configuring" href="configuration.html"/>
        <link rel="prev" title="Traffic Ops - Migrating from 1.x to 2.x" href="migration_from_10_to_20.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="/" class="icon icon-home"> Traffic Control
        

        
          
          <img src="../../_static/tc_logo_c_only.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../basics/index.html">CDN Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basics/content_delivery_networks.html">Content Delivery Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/http_11.html">HTTP 1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/caching_proxies.html">Caching Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/cache_revalidation.html">Cache Control Headers and Revalidation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Traffic Control Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_ops.html">Traffic Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_portal.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_router.html">Traffic Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_monitor.html">Traffic Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_stats.html">Traffic Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_server.html">Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_vault.html">Traffic Vault</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administrator&#8217;s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Traffic Ops - Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="default_profiles.html">Traffic Ops - Default Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_from_10_to_20.html">Traffic Ops - Migrating from 1.x to 2.x</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Traffic Ops - Migrating from 2.0 to 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Traffic Ops - Configuring</a></li>
<li class="toctree-l2"><a class="reference internal" href="using.html">Traffic Ops - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Managing Traffic Ops Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_portal/installation.html">Traffic Portal Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_portal/usingtrafficportal.html">Traffic Portal - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_monitor.html">Traffic Monitor Administration (Legacy)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_monitor_golang.html">Traffic Monitor Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_router.html">Traffic Router Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_stats.html">Traffic Stats Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_server.html">Traffic Server Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_vault.html">Traffic Vault Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quick_howto/index.html">Quick How To Guides</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Developer&#8217;s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/building.html">Building Traffic Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_ops.html">Traffic Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_portal.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_router.html">Traffic Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_monitor.html">Traffic Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_monitor_golang.html">Traffic Monitor Golang</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_stats.html">Traffic Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_server.html">Traffic Server</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/general.html">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/development.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/administration.html">Running a Traffic Control CDN</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Traffic Control</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Traffic Control 2.2-dev</a> &raquo;</li>
      
          <li><a href="../index.html">Administrator&#8217;s Guide</a> &raquo;</li>
      
    <li>Traffic Ops - Migrating from 2.0 to 2.2</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/admin/traffic_ops/migration_from_20_to_22.rst.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
 		  
    		  <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      		  
        		  <a href="configuration.html" class="btn btn-neutral float-right" title="Traffic Ops - Configuring">Next <span class="fa fa-arrow-circle-right"></span></a>
      		  
      		  
        		  <a href="migration_from_10_to_20.html" class="btn btn-neutral" title="Traffic Ops - Migrating from 1.x to 2.x"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      		  
    		  </div>
  		  
          <div role="main" class="document">
            
  <div class="section" id="traffic-ops-migrating-from-2-0-to-2-2">
<h1>Traffic Ops - Migrating from 2.0 to 2.2<a class="headerlink" href="#traffic-ops-migrating-from-2-0-to-2-2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="per-deliveryservice-routing-names">
<h2>Per-DeliveryService Routing Names<a class="headerlink" href="#per-deliveryservice-routing-names" title="Permalink to this headline">¶</a></h2>
<p>Before this release, DNS Delivery Services were hardcoded to use the name &#8220;edge&#8221;, i.e. &#8220;edge.myds.mycdn.com&#8221;, and HTTP Delivery Services use the name &#8220;tr&#8221; (or previously &#8220;ccr&#8221;), i.e. &#8220;tr.myds.mycdn.com&#8221;. As of 2.2, Routing Names will default to &#8220;cdn&#8221; if left unspecified and can be set to any arbitrary non-dotted hostname.</p>
<p>Pre-2.2 the HTTP Routing Name is configurable via the http.routing.name option in in the Traffic Router http.properties config file. If your CDN uses that option to change the name from &#8220;tr&#8221; to something else, then you will need to perform the following steps for each CDN affected:</p>
<ol class="arabic simple">
<li>In Traffic Ops, create the following profile parameter (double-check for typos, trailing spaces, etc):</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><strong>name</strong>: upgrade_http_routing_name</li>
<li><strong>config file</strong>: temp</li>
<li><strong>value</strong>: whatever value is used for the affected CDN&#8217;s http.routing.name</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Add this parameter to a single profile in the affected CDN</li>
</ol>
<p>With those profile parameters in place Traffic Ops can be safely upgraded to 2.2. Before taking a post-upgrade snapshot, make sure to check your Delivery Service example URLs for unexpected Routing Name changes. Once Traffic Ops has been upgraded to 2.2 and a post-upgrade snapshot has been taken, your Traffic Routers can be upgraded to 2.2 (Traffic Routers must be upgraded after Traffic Ops so that they can work with custom per-DeliveryService Routing Names).</p>
</div>
<div class="section" id="apache-traffic-server-7-x-cachekey-plugin">
<h2>Apache Traffic Server 7.x (Cachekey Plugin)<a class="headerlink" href="#apache-traffic-server-7-x-cachekey-plugin" title="Permalink to this headline">¶</a></h2>
<p>In Traffic Ops 2.2 we have added support for Apache Traffic Server 7.x. With 7.x comes support for the new cachekey plugin which replaces the cacheurl plugin which is now deprecated.
While not needed immediately it is recommended to start replacing cacheurl usages with cachekey as soon as possible because ATS 6.x already supports the new cachekey plugin.</p>
<p>It is also recommended to thoroughly vet your cachekey replacement by comparing with an existing key value. There are inconsistencies in the 6.x version of cachekey which have been
fixed in 7.x (or require this patch(<a class="reference external" href="https://github.com/apache/trafficserver/commit/244288fab01bdad823f9de19dcece62a7e2a0c11">cachekeypatch</a>) on 6.x to match 7.x). So to ensure you have a matching key value you should use the xdebug plugin before fully implementing your cachekey replacement.</p>
<p>First if you are currently using a regex for your delivery service you will have to remove that existing value. Then you will need to make a new DS profile and assign parameters in
it to the cachekey.config file.</p>
<p>Some common parameters are</p>
<div class="highlight-none"><div class="highlight"><pre>static-prefix      - This is used for a simple domain replacement
separator          - Used by cachekey and in general is always a single space
remove-path        - Removes path information from the URL
remove-all-params  - Removes parameters from the URL
capture-prefix-uri - This is usually used in combination with remove-path and remove-all-params.
                     Capture-prefix-uri will let you use your own full regex value for non simple cases
</pre></div>
</div>
<div class="section" id="examples-of-cacheurl-to-cachekey-replacements">
<h3>Examples of Cacheurl to Cachekey Replacements<a class="headerlink" href="#examples-of-cacheurl-to-cachekey-replacements" title="Permalink to this headline">¶</a></h3>
<p><strong>Original regex value:</strong></p>
<p><code class="docutils literal"><span class="pre">http://test.net/(.*)</span> <span class="pre">http://test-cdn.net/$1</span></code></p>
<p><strong>Cachekey parameters:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="26%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">File</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>static-prefix</td>
<td>cachekey.config</td>
<td><code class="docutils literal"><span class="pre">http://test-cdn.net/</span></code></td>
</tr>
<tr class="row-odd"><td>separator</td>
<td>cachekey.config</td>
<td>(empty space)</td>
</tr>
</tbody>
</table>
<p><strong>Original regex value:</strong></p>
<p><code class="docutils literal"><span class="pre">http://([^?]+)(?:?|$)</span> <span class="pre">http://test-cdn.net/$1</span></code></p>
<p><strong>Cachekey parameters:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="18%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">File</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>remove-path</td>
<td>cachekey.config</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>remove-all-params</td>
<td>cachekey.config</td>
<td>true</td>
</tr>
<tr class="row-even"><td>separator</td>
<td>cachekey.config</td>
<td>(empty space)</td>
</tr>
<tr class="row-odd"><td>capture-prefix-uri</td>
<td>cachekey.config</td>
<td><code class="docutils literal"><span class="pre">/https?:\/\/([^?]*)/http:\/\/test-cdn.net\/$1/</span></code></td>
</tr>
</tbody>
</table>
<p>Also note the <code class="docutils literal"><span class="pre">s?</span></code> used here so that both http and https requests will end up with the same key value</p>
<p><strong>Original regex value:</strong></p>
<p><code class="docutils literal"><span class="pre">http://test.net/([^?]+)(?:\?|$)</span> <span class="pre">http://test-cdn.net/$1</span></code></p>
<p><strong>Cachekey parameters:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="25%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">File</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>static-prefix</td>
<td>cachekey.config</td>
<td><code class="docutils literal"><span class="pre">http://test-cdn.net/</span></code></td>
</tr>
<tr class="row-odd"><td>separator</td>
<td>cachekey.config</td>
<td>(empty space)</td>
</tr>
<tr class="row-even"><td>remove-all-params</td>
<td>cachekey.config</td>
<td>true</td>
</tr>
</tbody>
</table>
<p>Further documentation on the cachekey plugin can be found at <a class="reference external" href="https://docs.trafficserver.apache.org/en/latest/admin-guide/plugins/cachekey.en.html">ApacheTrafficServerDocs</a></p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Traffic Ops - Configuring">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="migration_from_10_to_20.html" class="btn btn-neutral" title="Traffic Ops - Migrating from 1.x to 2.x"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">Apache Traffic Control (Incubating)</span>
      v: 
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        <dd><a href="/docs/master/">latest</a></dd>
        <dd><a href="/docs/2.0/">2.0</a></dd>
        <dd><a href="/docs/1.8.1/">1.8</a></dd>
        <dd><a href="/docs/1.7.0/">1.7</a></dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.2-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>