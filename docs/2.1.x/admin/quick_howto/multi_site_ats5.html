

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configure Multi Site Origin (5.x) &mdash; Traffic Control 2.1.0 documentation </title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Traffic Control 2.1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Quick How To Guides" href="index.html"/>
        <link rel="next" title="Configure DNSSEC" href="dnssec.html"/>
        <link rel="prev" title="Configure Multi Site Origin" href="multi_site.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="/" class="icon icon-home"> Traffic Control
        

        
          
          <img src="../../_static/tc_logo_c_only.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../basics/index.html">CDN Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basics/content_delivery_networks.html">Content Delivery Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/http_11.html">HTTP 1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/caching_proxies.html">Caching Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/cache_revalidation.html">Cache Control Headers and Revalidation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Traffic Control Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_ops.html">Traffic Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_portal.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_router.html">Traffic Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_monitor.html">Traffic Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_stats.html">Traffic Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_server.html">Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/traffic_vault.html">Traffic Vault</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../traffic_ops/installation.html">Traffic Ops - Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_ops/default_profiles.html">Traffic Ops - Default Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_ops/migration_from_10_to_20.html">Traffic Ops - Migrating from 1.x to 2.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_ops/configuration.html">Traffic Ops - Configuring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_ops/using.html">Traffic Ops - Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_ops/extensions.html">Managing Traffic Ops Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_portal.html">Traffic Portal Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_monitor.html">Traffic Monitor Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_monitor_golang.html">Traffic Monitor Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_router.html">Traffic Router Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_stats.html">Traffic Stats Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_server.html">Traffic Server Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traffic_vault.html">Traffic Vault Administration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Quick How To Guides</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Developer’s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/building.html">Building Traffic Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_ops.html">Traffic Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_portal.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_router.html">Traffic Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_monitor.html">Traffic Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_monitor_golang.html">Traffic Monitor Golang</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_stats.html">Traffic Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/traffic_server.html">Traffic Server</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/general.html">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/development.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/administration.html">Running a Traffic Control CDN</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Traffic Control</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Traffic Control 2.1.0</a> &raquo;</li>
      
          <li><a href="../index.html">Administrator’s Guide</a> &raquo;</li>
      
          <li><a href="index.html">Quick How To Guides</a> &raquo;</li>
      
    <li>Configure Multi Site Origin (5.x)</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/admin/quick_howto/multi_site_ats5.rst.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
 		  
    		  <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      		  
        		  <a href="dnssec.html" class="btn btn-neutral float-right" title="Configure DNSSEC">Next <span class="fa fa-arrow-circle-right"></span></a>
      		  
      		  
        		  <a href="multi_site.html" class="btn btn-neutral" title="Configure Multi Site Origin"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      		  
    		  </div>
  		  
          <div role="main" class="document">
            
  <div class="section" id="configure-multi-site-origin-5-x">
<span id="rl-multi-site-origin-qht-ats5"></span><h1>Configure Multi Site Origin (5.x)<a class="headerlink" href="#configure-multi-site-origin-5-x" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li>Create “cachegroups” for the origin locations, and assign the appropriate parent-child relationship between the mid cg’s and org cgs (click the image to see full size):</li>
</ol>
<a class="reference internal image-reference" href="../../_images/C5C4CD22-949A-48FD-8976-C673083E2177.png"><img alt="../../_images/C5C4CD22-949A-48FD-8976-C673083E2177.png" class="align-center" src="../../_images/C5C4CD22-949A-48FD-8976-C673083E2177.png" style="width: 1472.0px; height: 210.0px;" /></a>
<ol class="arabic simple" start="2">
<li>Create a profile to assign to each of the origins:</li>
</ol>
<a class="reference internal image-reference" href="../../_images/19BB6EC1-B6E8-4D22-BFA0-B7D6A9708B42.png"><img alt="../../_images/19BB6EC1-B6E8-4D22-BFA0-B7D6A9708B42.png" class="align-center" src="../../_images/19BB6EC1-B6E8-4D22-BFA0-B7D6A9708B42.png" style="width: 1470.0px; height: 219.0px;" /></a>
<ol class="arabic simple" start="3">
<li>Create server entries for the origination vips:</li>
</ol>
<a class="reference internal image-reference" href="../../_images/D28614AA-9758-45ED-9EFD-3A284FC4218E.png"><img alt="../../_images/D28614AA-9758-45ED-9EFD-3A284FC4218E.png" class="align-center" src="../../_images/D28614AA-9758-45ED-9EFD-3A284FC4218E.png" style="width: 1468.0px; height: 166.0px;" /></a>
<ol class="arabic simple" start="4">
<li>Check the multi-site check box in the delivery service screen:</li>
</ol>
<a class="reference internal image-reference" href="../../_images/mso-enable.png"><img alt="../../_images/mso-enable.png" class="align-center" src="../../_images/mso-enable.png" style="width: 1695.0px; height: 1079.0px;" /></a>
<ol class="arabic simple" start="5">
<li>Assign the org servers to the delivery service that will have the multi site feature:</li>
</ol>
<a class="reference internal image-reference" href="../../_images/066CEF4F-C1A3-4A89-8B52-4F72B0531367.png"><img alt="../../_images/066CEF4F-C1A3-4A89-8B52-4F72B0531367.png" class="align-center" src="../../_images/066CEF4F-C1A3-4A89-8B52-4F72B0531367.png" style="width: 580.0px; height: 343.0px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">“Origin Server Base URL” uniqueness: In order to enable MID caches to distinguish delivery services by different MSO algorithms while performing parent failover, it requires that “Origin Server Base URL” (OFQDN) for each MSO enabled delivery service is unique unless the exceptions listed afterwards. This means that the OFQDN of a MSO enabled delivery service should be different with the OFQDNs of any other delivery service, regardless of whether they are MSO enabled or not. The exceptions are:
1) If there are multiple CDNs created on the same Traffic Ops, delivery services across different CDNs may have the same OFQDN configured.
2) If several delivery services in the same CDN have the same MSO algorithm configured, they may share the same OFQDN.
3) If delivery services are assigned with different MID cache groups respectively, they can share the same OFQDN.</p>
</div>
<ol class="arabic simple" start="6">
<li>Select an option from the “Multi Site Origin Algorithm” drop-down list. Four MSO algorithms are supported:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Consistent hash</td>
<td>Origin server selection is based on the consistent hash of requested URLs.</td>
</tr>
<tr class="row-odd"><td>Primary/back</td>
<td>Round robin selection does not occur. The first origin server is selected unless it fails.
If the first fails, the second and other following origin servers will be tried by order.
Order is defined by 2 factors - if the origin server’s cachegroup is configured as the
parent cachegroup for the mid, then this server will be used as the primary. The same rules
apply for secondary parents, in order.  Within the cachegroups, the rank parameter will sort
order further. If no parents are defined at the mid, then only rank is considered.</td>
</tr>
<tr class="row-even"><td>Strict
round-robin</td>
<td>MID caches serve requests strictly in turn. For example: origin server 1 serves the first request,
origin server 2 serves the second request, and so on.</td>
</tr>
<tr class="row-odd"><td>IP based
round-robin</td>
<td>MID cache goes through the origin server list in a round robin-based on the IP address of EDGE cache.</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="7">
<li>Optionally, there are two configuration options that can set the order of the origins used if “Primary/backup” is selected for “Multi Site Origin Algorithm”. By creating location-based cachegroups and assigning the origin servers accordingly and defining these cachegroups as parents for specific mids, location-based primary/secondary selection can be made.   If primary/secondary selection should be the same for all mids, then a new parameter “rank” should be configured for each origin server profile. Origin servers with lower values of rank have higher ranking in the origin server list on MID caches, e.g. OS with rank of “2” precedes OS with the rank of “5”. For any OS, if rank value is not defined in its profile, its rank value will default to “1”.  In the event that both location based cachegroups are used alongside rank, sorting will be by cachegroup first and rank second.  In this way it is possible to have specific backup servers for use at specific locations.</li>
</ol>
<a class="reference internal image-reference" href="../../_images/mso-rank.png"><img alt="../../_images/mso-rank.png" class="align-center" src="../../_images/mso-rank.png" style="width: 585.0px; height: 105.6px;" /></a>
<ol class="arabic simple" start="8">
<li>Assign the parent.config location parameter to the MID profile:</li>
</ol>
<a class="reference internal image-reference" href="../../_images/D22DCAA3-18CC-48F4-965B-5312993F9820.png"><img alt="../../_images/D22DCAA3-18CC-48F4-965B-5312993F9820.png" class="align-center" src="../../_images/D22DCAA3-18CC-48F4-965B-5312993F9820.png" style="width: 658.0px; height: 601.0px;" /></a>
<ol class="arabic" start="9">
<li><p class="first">Configure the mid hdr_rewrite on the delivery service, example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">%</span><span class="p">{</span><span class="n">REMAP_PSEUDO_HOOK</span><span class="p">}</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">parent_origin</span><span class="o">.</span><span class="n">dead_server_retry_enabled</span> <span class="mi">1</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">parent_origin</span><span class="o">.</span><span class="n">simple_retry_enabled</span> <span class="mi">1</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">parent_origin</span><span class="o">.</span><span class="n">simple_retry_response_codes</span> <span class="s2">&quot;400,404,412&quot;</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">parent_origin</span><span class="o">.</span><span class="n">dead_server_retry_response_codes</span> <span class="s2">&quot;502,503&quot;</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">connect_attempts_timeout</span> <span class="mi">2</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">connect_attempts_max_retries</span> <span class="mi">2</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">connect_attempts_max_retries_dead_server</span> <span class="mi">1</span> <span class="n">__RETURN__</span> <span class="nb">set</span><span class="o">-</span><span class="n">config</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">transaction_active_timeout_in</span> <span class="mi">5</span> <span class="p">[</span><span class="n">L</span><span class="p">]</span> <span class="n">__RETURN__</span>
</pre></div>
</div>
</li>
<li><p class="first">Turn on parent_proxy_routing in the MID profile.</p>
</li>
</ol>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dnssec.html" class="btn btn-neutral float-right" title="Configure DNSSEC">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multi_site.html" class="btn btn-neutral" title="Configure Multi Site Origin"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>